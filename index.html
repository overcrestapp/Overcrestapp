<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Digital Whiteboard – Fordon & Mätning</title>

    <!-- CSP + CDN (ingen build behövs) -->
    <meta http-equiv="Content-Security-Policy"
      content="default-src 'self' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; script-src 'self' 'unsafe-inline'; img-src 'self' data:;">

    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-900 text-slate-100 min-h-screen">
    <div class="max-w-5xl mx-auto p-4">
      <h1 class="text-2xl font-bold mb-4">Digital Whiteboard</h1>

      <!-- Fordonsrader -->
      <section id="vehicles" class="space-y-2 mb-6">
        <!-- Raderna genereras av JS -->
      </section>

      <!-- Mät-rader F1–F3 -->
      <section id="measure" class="mt-8 space-y-2">
        <h2 class="text-xl font-semibold mb-2">Mätning</h2>
        <div id="measureRows" class="space-y-2"><!-- fylld av JS --></div>
      </section>
    </div>

    <script>
      // ---------- Hjälp ----------
      const LS_KEY = "dw_simple_v1";
      const data = loadLS() || { vehicles: {}, measures: {} };

      function saveLS(){
        try { localStorage.setItem(LS_KEY, JSON.stringify(data)); } catch {}
      }
      function loadLS(){
        try { return JSON.parse(localStorage.getItem(LS_KEY)); } catch { return null }
      }
      function pad(n){ return String(n).padStart(2,"0"); }
      function nowTime(){
        const d = new Date();
        return `${pad(d.getHours())}:${pad(d.getMinutes())}`;
      }

      // ---------- Fordon 67–91 (25 rader) ----------
      const vehiclesEl = document.getElementById("vehicles");
      const startNr = 67, rows = 25;

      for(let i=0;i<rows;i++){
        const nr = startNr + i;
        const row = document.createElement("div");
        row.className = "grid grid-cols-[72px,1fr,120px] gap-2 items-center rounded-xl p-2 bg-slate-800/60 ring-1 ring-slate-700";

        // Nummer
        const label = document.createElement("div");
        label.className = "text-center font-semibold bg-white/10 rounded-lg py-2 select-none";
        label.textContent = nr;

        // Inputruta
        const inp = document.createElement("input");
        inp.type = "text";
        inp.placeholder = "Skriv här…";
        inp.className = "w-full bg-white/5 rounded-lg px-3 py-2 leading-6 outline-none";
        inp.value = data.vehicles[nr]?.text || "";
        inp.addEventListener("input", () => {
          data.vehicles[nr] = data.vehicles[nr] || {};
          data.vehicles[nr].text = inp.value;
          saveLS();
        });

        // Körförbud-knapp
        const btn = document.createElement("button");
        btn.textContent = "Körförbud";
        btn.className = "px-3 py-2 rounded-lg font-semibold bg-red-600 hover:bg-red-500";
        const banned = !!data.vehicles[nr]?.ban;
        if (banned) markBanned(true);
        btn.addEventListener("click", ()=>{
          const curr = !!data.vehicles[nr]?.ban;
          markBanned(!curr);
          data.vehicles[nr] = data.vehicles[nr] || {};
          data.vehicles[nr].ban = !curr;
          saveLS();
        });

        function markBanned(on){
          if(on){
            row.classList.add("ring-red-600","bg-red-900/70");
            row.classList.remove("ring-slate-700","bg-slate-800/60");
            inp.classList.add("placeholder-red-200","text-red-50","bg-red-800/60");
          }else{
            row.classList.remove("ring-red-600","bg-red-900/70");
            row.classList.add("ring-slate-700","bg-slate-800/60");
            inp.classList.remove("placeholder-red-200","text-red-50","bg-red-800/60");
            inp.classList.add("bg-white/5");
          }
        }

        row.append(label, inp, btn);
        vehiclesEl.appendChild(row);
      }

      // ---------- Mätning F1–F3 ----------
      const measureRowsEl = document.getElementById("measureRows");
      ["F1","F2","F3"].forEach(tag=>{
        const wrap = document.createElement("div");
        wrap.className = "grid grid-cols-[72px,1fr,140px] gap-2 items-center rounded-xl p-2 bg-slate-800/60 ring-1 ring-slate-700";

        const lab = document.createElement("div");
        lab.className = "text-center font-semibold bg-white/10 rounded-lg py-2 select-none";
        lab.textContent = tag;

        const inp = document.createElement("input");
        inp.type = "text";
        inp.placeholder = "Mätsiffra…";
        inp.className = "w-full bg-white/5 rounded-lg px-3 py-2 leading-6 outline-none";
        inp.value = data.measures[tag]?.value || "";

        const timeBox = document.createElement("div");
        timeBox.className = "text-sm text-slate-300 text-right";
        timeBox.textContent = data.measures[tag]?.time ? `kl ${data.measures[tag].time}` : "";

        inp.addEventListener("input", ()=>{
          const t = nowTime();
          data.measures[tag] = { value: inp.value, time: t };
          timeBox.textContent = inp.value ? `kl ${t}` : "";
          saveLS();
        });

        wrap.append(lab, inp, timeBox);
        measureRowsEl.appendChild(wrap);
      });
    </script>
  </body>
</html>
